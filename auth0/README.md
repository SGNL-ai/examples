# Auth0 Post-Login Action Example
This Node.js example demonstrates how to call the SGNL Access Service from an Auth0 custom post-login action. This action is then configured as part of an Auth0 login flow.


# Prerequisites

1. You have a SGNL environment up and running.
 
2. You have configured connectors to ingest data and have defined the appropriate relationship mappings.
 
3. You have created policy snippets and policy for evaluation.
 
4. You have created an protected application to test. You can use an Auth0 example such as the React single page application.
 
5. You will need Git to clone the example repository. You can follow the steps to install Git [here](https://github.com/git-guides/install-git).


See our [Help Guides](https://support.sgnl.ai) for steps on configuring data sources and policies.


## Steps For Creating The Example Custom Action


1. Clone the example repo using Git from https://github.com/SGNL-ai/examples.git.
2. Login to your Auth0 dashboard.
3. Click on the Actions menu item.
4. Click on the Library menu item. Then click on the Custom tab.
5. Click on the Build Custom button.
6. Give your action a name and select Login/Post Login from the drop down list.
7. Select Node 18 for the runtime, and click on create.
8. Switch to the auth0 directory in your cloned examples repository.
9. Copy the contents of the *login-action.js* file to the Auth0 Node.js editor.
10. Click on the secrets key icon on the left navigation bar.
11. Click on the add secret button.
12. Name the secret "sgnl_url", and insert the SGNL access service URL value.
13. Click on the add secret button.
14. Name the secret "Token", and insert the protected system bearer token generated by the SGNL user interface.
15. Click on "Save Draft" button in the upper right navigation bar.
16. Congratulations, you are now ready to test!


## Steps For Testing The Example

1. Ensure you are in the code editor view.
2. Click on the play button in the upper left navigation bar.
3. Update the sample POST body to send the principal and request context you want to test with.
4. Click on the Run button and see results in the lower right hand window pane.

## Steps For Deploying The Example

1. Ensure you are in the code editing view.
2. Click on the "Deploy" button.
3. Click on the Actions and Flows menu items on the left navigation bar.
4. Click on the Login flow button.
5. Cick the "Custom" tab in the add action area.
6. Drag your custom post-login flow action and place it between the Start and Complete steps.
7. Click on the Apply button on the top righ naviation bar.
8. You have now deployed the custom action, and sending real-time authorization requests after a user is authenticated.

## Congratulations
You have now run an SGNL authorization query from an Auth0 post-login action. By doing this, you are taking advantage of the power SGNL has to extend Auth0 with enterprise capabilities such as continous access management, centralized policy management, audit, and reporting.



